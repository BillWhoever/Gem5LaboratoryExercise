# 1η Εργασία Αρχιτεκτονικής Προηγμένων Υπολογιστών
_του Βασιλείου Μπεσλεμέ και του Διονυσίου Δανιήλ Πλέσσα_<br>
[vampesle@ece.auth.gr](mailto:vampesle@ece.auth.gr), [dplessas@ece.auth.gr](mailto:dplessas@ece.auth.gr)<br>
9862, 9768

## Ερώτημα 1.
Ο τύπος CPU που χρησιμοποιούμε είναι **ARM** και συγκεκριμένα τύπου **"minor"** (δεδομένου του "configs/example/arm/starter_se.py" και της σημαίας `--cpu=minor`):
> `from common.cores.arm import HPI`

<br>

#### Οι διαθέσιμες μνήμες cache του συστήματός μας είναι οι εξής :
* Μνήμη cache L1 (εντολών και δεδομένων, L1i, L1d)
* Μνήμη cache L1  (L1d)
* Μνήμη cache L2 (L2)
* TLB (εντολών και δεδομένων, iTB, dTB, αναφερόμενη και ως "Walker Cache")

Επιπρόσθετες πληροφορίες για τις μνήμες cache (π.χ. μέγεθος, associativity κλπ.), μπορούν να βρεθούν στο αρχείο "/configs/common/Options.py".

<br>

#### Έχουμε τα arguments παρακάτω:
* **Οι εντολές που θα εκτελεστούν:**
    > `parser.add_argument("commands_to_run", metavar="command(s)", nargs='*', help="Command(s) to run")`
* **Η συχνότητα των επεξεργαστών (προεπιλογή 1GHz):**
    > `parser.add_argument("--cpu-freq", type=str, default="1GHz")`
* **Ο αριθμός των επεξεργαστών (προεπιλογή 1):**
    > `parser.add_argument("--num-cores", type=int, default=1, help="Number of CPU cores")`
* **Η μνήμη RAM που θα χρησιμοποιηθεί (προεπιλογή DDR3 1600MHz)**
    > `parser.add_argument("--mem-type", default="DDR3_1600_8x8", choices=ObjectList.mem_list.get_names(), help = "type of memory to use")`
* **Τα κανάλια μνήμης RAM του συστήματός μας (προεπιλογή 2)**
    > `parser.add_argument("--mem-channels", type=int, default=2, help = "number of memory channels")`
* **Το μέγεθος μνήμης RAM του συστήματός μας (προεπιλογή 2GB)**
    > `parser.add_argument("--mem-size", action="store", type=str, default="2GB", help="Specify the physical memory size")`

<br>

#### Μπορούμε πολύ εύκολα να αλλάξουμε τις παραμέτρους αυτές χρησιμοποιώντας τα flags:
* `--cpu-freq=`
* `--num-cores=`
* `--mem-size=`

Για παράδειγμα, μπορούμε να τρέξουμε το πρόγραμμα "Hello World!" σε σύστημα ARM με επεξεργαστή "minor", που τρέχει στα 1.6GHz και με μνήμη 4GB, χρησιμοποιώντας την εντολή:
> `./build/ARM/gem5.opt configs/example/arm/starter_se.py --cpu="minor" --cpu-freq='1.6GHz' --mem-size="4GB" "tests/test-progs/hello/bin/arm/linux/hello"`

<br>

## Ερώτημα 2.

Το **"sim_seconds"** δίνει το χρόνο εκτέλεσης του προγράμματος σε δευτερόλεπτα και προκύπτει από το sim_ticks*(10^(-12)) αφού τα tick του προσομοιωτή αντιστοιχούν σε picoseconds.
> sim_seconds    **0.000035** (@ 1GHz, 2GB)<br>
sim_seconds    **0.000029** (@ 1.6GHz, 4GB)

Το **"sim_insts"** δίνει τον αριθμό των εντολών που εκτελέστηκαν.
> sim_insts    **5027** (@ 1GHz, 2GB)<br>
sim_insts    **5027** (@ 1.6GHz, 4GB)

Το **"host_inst_rate"** δίνει τον αριθμό των εντολών που εκτέλεσε ο υπολογιστής προσομοίωσης ανά δευτερόλεπτο, επομένως και την ταχύτητα εκτέλεσης της προσομοίωσης σε πραγματικό χρόνο. Θα εξαρτάται από το σύστημα που εκτελεί την προσομοίωση καθώς και από τον βαθμό εκμετάλλευσης των πόρων του.
> host_inst_rate    **130591** (@ 1GHz 2GB)<br>
host_inst_rate    **113694** (@ 1.6GHz 4GB)

<br>

## Ερώτημα 3.
Τύπος:
_CPI = 1 + ((IL1.miss_num + DL1.miss_num) * 6 + L2.miss_num * 50)/Total_Inst_num_

#### Από τo αρχείο "stats.txt" έχουμε (_@ 1GHz, 2GB_):  
>sim_insts    **5027**<br>
system.cpu_cluster.cpus.icache.demand_misses::total    **327**<br>
system.cpu_cluster.cpus.dcache.demand_misses::total    **177**<br>
system.cpu_cluster.l2.demand_misses::total    **474**

Οπότε προκύπτει το παρακάτω CPI:
_CPI = **6.316**_

<br>

## Ερώτημα 4.

#### 1. SimpleCPU
Είναι απλοϊκό μοντέλο επεξεργαστή που χρησιμοποιείται όταν δεν απαιτείται κάποιο πιο περίπλοκο μοντέλο. Το πλεονέκτημά του είναι η γρήγορη εκτέλεση προγραμμάτων για απλό έλεγχο λειτουργικότητας. Δεν υπάρχει pipeline και γι' αυτό το συγκεκριμένο μοντέλο δεν είναι αντιπροσωπευτικό των πραγματικών επεξεργαστών.

Υποκατηγορίες του SimpleCPU είναι οι AtomicSimpleCPU και TimingSimpleCPU. Βασική διαφορά των δύο είναι ο τρόπος αντιμετώπισης των memory requests. Το AtomicSimple μοντέλο δεν σπαταλά καθόλου χρόνο στα memory requests και χρησιμοποιεί εκτιμήσεις για τις καθυστερήσεις των μνημών. Στο TimingSimple μοντέλο έχουμε παύση του επεξεργαστή σε κάθε memory request καθώς και πλήρη προσομοίωση των κρυφών μνημών, οπότε έχουμε καλύτερα και πιο ακριβή αποτελέσματα για το χρόνο που σπαταλάται στη μνήμη.

<br>

#### 2. MinorCPU
Είναι μοντέλο με pipeline που επιτρέπει μεγάλη ελευθερία στην δομή των μνημών. Μπορεί να χρησιμοποιηθεί για την μελέτη της λειτουργίας του pipeline και στοχεύει στην πιο ακριβή προσομοίωση πραγματικών επεξεργαστών.

<br>

### a.
Υπάρχει μεγάλη διαφορά στον χρόνο εκτέλεσης καθώς και στους χρόνους εκτέλεσης της προσομοίωσης. Συγκεκριμένα, παρατηρούμε ότι ενώ το μοντέλο TimingSimpleCPU είναι 2.8 φορές γρηγορότερο, έχουμε το αντίθετο ακριβώς αποτέλεσμα στο συνολικό χρόνο εκτέλεσης (`host_seconds`), όπου η προσομοίωση του MinorCPU είναι 2.15 φορές γρηγορότερη. Παρακάτω έχουμε τα αποτελέσματα που αφορούν τους αναφερόμενους χρόνους.

<br>

#### Αποτελέσματα

* **MinorCPU**:
> sim_seconds = **0.024377**<br>
sim_insts = **35231154**<br>
host_inst_rate = **295209**<br>
host_seconds = **119.34**

* **TimingSimpleCPU**:
> sim_seconds = **0.052376**<br>
sim_insts = **35208730**<br>
host_inst_rate = **828590**<br>
host_seconds = **42.49**

<br>

### b.
Οι default ρυθμίσεις μπορούν να βρεθούν στο **"/configs/common/Options.py"** και είναι:
 >  `--mem-type=MEM_TYPE default ="DDR3_1600_8x8"`<br>
 `--cpu-clock=CPU_CLOCK default='2GHz'`

Θα ξανατρέξουμε τις προσομοιώσεις με σύστημα:
 >  `--mem-type="DDR4_2400_16x4"`<br>
 `--cpu-clock='4GHz'`

<br>

#### Αποτελέσματα
* **MinorCPU** (`--cpu-clock='4GHz'`):  
> sim_seconds = **0.012992**	(-46.5%)

* **TimingSimpleCPU** (`--cpu-clock='4GHz'`):
> sim_seconds = **0.026513**	(-49.5%)

* **MinorCPU**  (`--mem-type="DDR4_2400_16x4"`):
> sim_seconds = **0.024035**	(-1.5%)

* **TimingSimpleCPU** (`--mem-type="DDR4_2400_16x4"`):
> sim_seconds = **0.052214**	(-0.5%)

* **MinorCPU** (`--cpu-clock='4GHz' --mem-type="DDR4_2400_16x4"`):
> sim_seconds = **0.012658**	(-48%)

* **TimingSimpleCPU** (`--cpu-clock='4GHz' --mem-type="DDR4_2400_16x4"`):
> sim_seconds = **0.026347**	(-49.5%)

_*ποσοστά σε σύγκριση με το default σύστημα._

<br>

#### Συμπεράσματα
Και τα δύο CPU models έχουν μεγάλη ευαισθησία στην αλλαγή της συχνότητας λειτουργίας και μικρή ευαισθησία στην αλλαγή της τεχνολογίας της μνήμης RAM κυρίως επειδή το πρόγραμμα που τρέξαμε είναι σειριακό, με μεγάλο αριθμό πράξεων και ελάχιστες μεταβλητές. Αυτό σημαίνει πως ο ρόλος των μνημών στην ταχύτητα εκτέλεσης του συγκεκριμένου προγράμματος είναι μικρός.

Σημαντικό είναι να αναφερθεί ότι μετά από το διπλασιασμό της συχνότητας λειτουργίας, η απόδοση της μνήμης RAM έγινε πιο σημαντική για την ταχύτητα εκτέλεσης. Συγκεκριμένα στα 4GHz σε MinorCPU model η αλλαγή στην τεχνολογία της μνήμης βελτίωσε τον χρόνο εκτέλεσης κατά -2.5% έναντι του -1.5% στα 2GHz. Αυτό δε φαίνεται να συμβαίνει με το TimingSimpleCPU model όπου η τεχνολογία της μνήμης έδωσε μηδαμινά αποτελέσματα βελτίωσης.

<br>

## Κριτική αυτής της εργασίας
Η εργασία θα μπορούσε να πει κανείς πως ήταν εύκολη, αφού τα ζητούμενα ήταν λίγα και απλά, και επιπλέον υπήρχαν οδηγίες βήμα προς βήμα για την εκτέλεση των προσομοιώσεων. Παρ' όλα αυτά, πολλά από τα εργαλεία που απαιτούνταν δεν ήταν οικεία σε εμάς. Αυτό είχε σαν αποτέλεσμα, για παράδειγμα, να χαραμίσουμε πολλές ώρες προσπαθώντας να κάνουμε build τον Gem5 λόγω των dependencies. Αντιμετωπίσαμε πολλαπλά σφάλματα κατά την διαδικασία, και το troubleshooting δε μας επέφερε κάποιες χρήσιμες γνώσεις εν τέλει.

Σχετικά με τη χρήση του Gem5, διαπιστώσαμε πως πολλές από τις δοσμένες εντολές δε λειτουργούσαν καθώς το πρόγραμμα απαιτούσε διαφορετικά ορίσματα στη γραμμή εντολών, πιθανώς επειδή η εκφώνηση της εργασίας βασίζεται σε παλαιότερη έκδοση του Gem5. Πιο συγκεκριμένα, για την εκτέλεση ενός προγράμματος με το αρχείο "configs/example/se.py" απαιτείται η σημαία `-c`, για την επιλογή επεξεργαστή `--cpu-type=` και για τη χρήση caches η `--caches`, για παράδειγμα:

```bash
./build/ARM/gem5.opt configs/example/se.py --cpu-type=TimingSimpleCPU --caches -c ./trajectoryCalc
```

Σε κάθε περίπτωση, θεωρούμε ότι έχουμε κερδίσει αρκετές γνώσεις σχετικά με τα virtual machines, τα Linux, το Git/GitHub και τον Gem5, και ότι αυτή η εργασία μας βοήθησε να έρθουμε σε επαφή με τα εργαλεία αυτά. Τέλος ο Gem5 φαίνεται αρκετά ενδιαφέρον λογισμικό με το οποίο θα μπορούσαμε να ασχοληθούμε και στο μέλλον.

